name: CI/CD Pipeline

on:
  push:
    paths:
      - 'src/**'
  pull_request:
    paths:
      - 'src/**'

jobs:
  test-backend:
    name: 游댌 Pruebas Backend (Python)
    runs-on: ubuntu-latest

    steps:
      - name: 游닌 Checkout
        uses: actions/checkout@v3

      - name: 游냀 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 游닍 Instalar dependencias Python
        working-directory: src/paginaweb/Backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest

      - name: 游빍 Ejecutar pruebas Python
        working-directory: src/paginaweb
        run: pytest tests/

  test-frontend:
    name: 游댌 Pruebas Frontend (JS)
    runs-on: ubuntu-latest

    steps:
      - name: 游닌 Checkout
        uses: actions/checkout@v3

      - name: 游릭 Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: 游닍 Instalar dependencias JS y ejecutar pruebas
        working-directory: src/paginaweb
        run: |
          npm ci
          npm test || echo "丘멆잺 No se encontraron pruebas"

  build-docker:
    name: 游냡 Build de im치genes Docker
    runs-on: ubuntu-latest
    needs: [test-backend, test-frontend]

    steps:
      - name: 游닌 Checkout
        uses: actions/checkout@v3

      - name: 游냡 Build backend
        run: docker build -f src/paginaweb/Backend/Dockerfile.backend -t backend-ci .

      - name: 游냡 Build frontend
        run: docker build -f src/paginaweb/Dockerfile.frontend -t frontend-ci .
